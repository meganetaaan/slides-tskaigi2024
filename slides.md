---
marp: true
theme: gaia
class: invert
paginate: true
---

# ｽﾀｯｸﾁｬﾝ

<!-- _class: lead -->

TypeScriptで作る<br>コミュニケーションロボット

![bg left:63%](./assets/images/in_your_hands.jpg)

---

## 自己紹介

- ししかわ
- Twitterのアカウントを凍結されている
  - @stack_chan 運用中

---

<!-- _class: lead -->

## 【前編】ｽﾀｯｸﾁｬﾝって何？

---

## ｽﾀｯｸﾁｬﾝ

- オープンソースのコミュニケーションロボット
- https://github.com/stack-chan/stack-chan

![w:600](./assets/images/stack_chan.jpg)

---

### オープンソースのコミュニケーションロボット

- Apache v2.0 で公開
  - 厳密にいうと回路や外装のデザインには著作権無いらしいが、製作者のオープンなスタンスを示すために付けている
  - 商用、非商用問わず利用可能
  - 実際、公開されているデータをもとに独自の変更を加えたり、変更したバージョンをキット化して販売する人も出てきている

---

### ｽﾀｯｸﾁｬﾝとコミュニティ

- ｽﾀｯｸﾁｬﾝのオープンな精神に共感した開発者が集まってコミュニティを形成した
- 昨年ChatGPTと接続した「AIｽﾀｯｸﾁｬﾝ」の登場で爆発的に拡大
- DiscordやTwitterで活発に活動中

---

### コミュニティの活動: 制作

- マイｽﾀｯｸﾁｬﾝ

---

### コミュニティの活動: お誕生日会

- 毎年やっているｽﾀｯｸﾁｬﾝオンリーのカンファレンス
- 1歳（参加者20人）->2歳（参加者50人）
- ケーキ！ピニャータ！

---

### コミュニティの活動: メイカー系イベント

- メイカーフェアやNT等、各種ものつくり系イベントへの出展
  - 他のイベントはコミュニティメンバー主導
  - 計画的 < ゲリラ的

---

### ｽﾀｯｸﾁｬﾝはTypeScriptで動く

- ｽﾀｯｸﾁｬﾝ本体で動くソースコードはすべてModdable
  - 音声合成
  - 顔とemoticonの描画
  - 対話管理（ChatGPT4やClaude3に対応）
  - モータードライバ
  - 上記機能の初期化や設定処理

---

### Why: なぜTypeScriptを使おうと思った？

- 自分が必要だったから
- ししかわは元々Web開発者->ロボットベンチャー
- C/C++のベストプラクティスと組み込み開発の知識を両方やらないといけない
- マイコンのベンダが提供する独自IDE
- Node.jsのパッケージ管理やLint、テストなどのエコシステムを流用したい
- 「Webの言語を使ってロボットを制御したい」

---

### 使い方

- 基本機能の「ホスト」の上にユーザアプリケーションの「mod」を使ってもらう
  - マイクラとかPCゲームをする人には馴染み深い単語。ユーザが定義できる拡張機能。
- 音声合成、対話管理などの機能モジュールごとにインタフェースを定義して実装。設定ファイルで置き換え可能にしてある

---

### Disclaimer: Moddable版ｽﾀｯｸﾁｬﾝは開発途上

- Arduinoが8割、Moddableが2割程度

---

<!-- _class: lead -->

## 【後編】ModdableとEcma-419

---

### マイコンの世界

- シングルボードコンピュータとは異なる
- 一段性能が劣る
- LinuxのようなOSを搭載
（Raspberry Pi Zero2とESP32S3の性能を比較する）

---

### Moddable SDKはマイコンの環境に最適化されている

- フットプリントがわずか

---

### Moddable SDKの組み込み向け機能の仕様が標準化されている

- Ecma-419 （組み込み向けJavaScript）
- 現在第2版が出てる: https://419.ecma-international.org/

サンプルコード（`examples/io/digital`より）
```
```

---

### 性能とのトレードオフ

- 省メモリ指向
- 細かい話だとMapの内部実装がHashMapじゃなくてListなのでランダムアクセスがO(n)
- 性能が求められる箇所はC言語で実装し、JSのグルーコードを介してスクリプトから利用できる
  - もちろんこのような関数に対しても型定義が用意されているし、自作も可能

---

### Webのエコシステムとの親和性

- TypeScript: ｽﾀｯｸﾁｬﾝのホストプログラムに適用済み
  - anyはあります
- ESLintとPrettier: （CI含め）使っている
- テスト: 使えるはず
- その他
  - ビジュアルプログラミングプラットフォームのNode-REDでModdableのコードを生成できる！

---

### まとめ：Moddableを使うとどうなるか

- 操作性/学習性（Usability）↑↑↑
  - Web開発者がマイコンで動くアプリを開発できる
- 互換性↑↑
  - 異なる種類のマイコンに対応
- アップデート容易性↑
- セキュリティ↑
- 性能効率（Performance Efficiency）↓
  - C APIで補う

---

## おわりに

### ミュニティに参加しよう！

- ｽﾀｯｸﾁｬﾝとModdableを中心に様々な活動をしている
  - ｽﾀｯｸﾁｬﾝコミュニティ
    - 3歳のお誕生日会の募集もうすぐ
    - メイカーフェア東京に出展企画中
    - Moddable版試してみてね！
  - Moddable日本開発者コミュニティ
    - Discordでワイワイ
